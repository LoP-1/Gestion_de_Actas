<!-- Barra de acciones solo para pantalla -->
<div class="print-toolbar no-print">
  <button mat-stroked-button color="primary" (click)="imprimir()">
    <mat-icon>print</mat-icon>
    Imprimir
  </button>
</div>

<!-- De aqui para abajo sera imprimible -->
<div id="print-area" *ngIf="!isLoading && data">
  <!-- Hoja A4 -->
  <div class="print-sheet a4">
    <!-- WRAPPER para escalar sin afectar el flujo/paginado -->
    <div class="print-inner">
      <!-- Encabezado del documento -->
      <header class="doc-header">
        <div class="doc-brand">
          <h1>Detalle de Boleta</h1>
        </div>
        <div class="doc-meta">
          <div><strong>Periodo:</strong> {{data?.periodoPago}}</div>
          <div><strong>Empleado:</strong> {{data?.nombres}} {{data?.apePaterno}} {{data?.apeMaterno}}</div>
          <div><strong>DNI:</strong> {{data?.nroDocumento}}</div>
        </div>
      </header>

      <!-- Cuerpo del documento (grid 2 columnas) -->
      <main class="sheet-grid">
        <!-- Columna izquierda: datos generales -->
        <section class="left-col">
          <h2 class="section-title">Datos del Usuario</h2>

          <mat-card class="boleta-card doc-card">
            <mat-card-content>
              <table class="mat-simple-table doc-table">
                <tr>
                  <td><strong>ID:</strong></td>
                  <td>{{data.id}}</td>
                  <td><strong>Periodo de Pago:</strong></td>
                  <td>{{data.periodoPago}}</td>
                </tr>
                <tr>
                  <td><strong>Nombre Completo:</strong></td>
                  <td>{{data.nombres}} {{data.apePaterno}} {{data.apeMaterno}}</td>
                  <td><strong>DNI:</strong></td>
                  <td>{{data.nroDocumento}}</td>
                </tr>
                <tr>
                  <td><strong>Fecha Nacimiento:</strong></td>
                  <td>{{data.fechaNacimiento || '-'}}</td>
                  <td><strong>Sexo:</strong></td>
                  <td>{{ formatearSexo(data.sexo) }}</td>
                </tr>
                <tr>
                  <td><strong>Cargo Orig:</strong></td>
                  <td>{{data.cargoOrig}}</td>
                  <td><strong>Cargo:</strong></td>
                  <td>{{data.cargo}}</td>
                </tr>
                <tr>
                  <td><strong>Documento Referencia:</strong></td>
                  <td>{{data.docReferencia}}</td>
                  <td><strong>Tipo Documento:</strong></td>
                  <td>{{data.tipoDocumento}}</td>
                </tr>
                <tr>
                  <td><strong>Fecha Ingreso:</strong></td>
                  <td>{{data.fechaIngreso || '-'}}</td>
                  <td><strong>Fecha Término:</strong></td>
                  <td>{{data.fechaTermino || '-'}}</td>
                </tr>
                <tr>
                  <td><strong>Código Modular:</strong></td>
                  <td>{{data.codigoModular}}</td>
                  <td><strong>Código Nexus:</strong></td>
                  <td>{{data.codNexus}}</td>
                </tr>
                <tr>
                  <td><strong>UGEL:</strong></td>
                  <td>{{data.ugel}}</td>
                  <td><strong>Establecimiento:</strong></td>
                  <td>{{data.establecimiento}}</td>
                </tr>
                <tr>
                  <td><strong>Código Establecimiento:</strong></td>
                  <td>{{data.codEstablecimiento}}</td>
                  <td><strong>Nivel:</strong></td>
                  <td>{{data.nivel}}</td>
                </tr>
                <tr>
                  <td><strong>Característica Establecimiento:</strong></td>
                  <td>{{data.caractEstablecimiento}}</td>
                  <td><strong>Unidad de Costeo:</strong></td>
                  <td>{{data.unidCosteo}}</td>
                </tr>
                <tr>
                  <td><strong>Reg. Pensionario:</strong></td>
                  <td>{{data.regPensionario}}</td>
                  <td><strong>AFP:</strong></td>
                  <td>{{ formatearAFP(data.afp) }}</td>
                </tr>
                <tr>
                  <td><strong>CUSPP:</strong></td>
                  <td>{{data.cuspp}}</td>
                  <td><strong>Fecha Afiliación:</strong></td>
                  <td>{{data.fechaAfiliacion || '-'}}</td>
                </tr>
                <tr>
                  <td><strong>IPSS:</strong></td>
                  <td>{{data.ipss}}</td>
                  <td><strong>Tipo Planilla:</strong></td>
                  <td>{{data.tPlanilla}}</td>
                </tr>
                <tr>
                  <td><strong>Modo Pago:</strong></td>
                  <td>{{data.modoPago}}</td>
                  <td><strong>Cuenta Bancaria:</strong></td>
                  <td>{{data.ctaCte}}</td>
                </tr>
                <tr>
                  <td><strong>Días Trabajados:</strong></td>
                  <td>{{data.diasTrabajados}}</td>
                  <td><strong>Días Licencia:</strong></td>
                  <td>{{data.diasLicencia}}</td>
                </tr>
                <tr>
                  <td><strong>Décimas:</strong></td>
                  <td>{{data.decimas}}</td>
                  <td><strong>Tiempo Servicio:</strong></td>
                  <td>{{data.tiempoServicio}}</td>
                </tr>
                <tr>
                  <td><strong>Reg. Laboral:</strong></td>
                  <td>{{data.regLaboral}}</td>
                  <td><strong>Tipo Servidor:</strong></td>
                  <td>{{data.tipoServidor}}</td>
                </tr>
                <tr>
                  <td><strong>Nivel Magisterial:</strong></td>
                  <td>{{data.nivelMagisterial}}</td>
                  <td><strong>Código Comuna:</strong></td>
                  <td>{{data.codcomuna}}</td>
                </tr>
                <tr>
                  <td><strong>Grupo Remunerativo:</strong></td>
                  <td>{{data.grupoRemunerativo}}</td>
                  <td><strong>Jornada Laboral:</strong></td>
                  <td>{{data.jornadaLaboral}}</td>
                </tr>
                <tr>
                  <td><strong>Cad. Presupuestal:</strong></td>
                  <td>{{data.cadPresupuestal}}</td>
                  <td><strong>T. Imponen:</strong></td>
                  <td>{{data.timpopen}}</td>
                </tr>
                <tr>
                  <td><strong>Imponible:</strong></td>
                  <td>{{data.imponible | number:'1.2-2'}}</td>
                  <td><strong>Tributable:</strong></td>
                  <td>{{data.tributable | number:'1.2-2'}}</td>
                </tr>
                <tr>
                  <td><strong>Total Remuneración:</strong></td>
                  <td>{{data.totalRemuneracion | currency:'S/.'}}</td>
                  <td><strong>Total Líquido:</strong></td>
                  <td>{{data.totalLiquido | currency:'S/.'}}</td>
                </tr>
                <tr>
                  <td><strong>Situación:</strong></td>
                  <td>{{data.situacion}}</td>
                  <td><strong>Leyenda Permanente:</strong></td>
                  <td>{{data.leyendaPermanente}}</td>
                </tr>
                <tr>
                  <td><strong>Fec Ini Lic:</strong></td>
                  <td>{{data.fecinilic || '-'}}</td>
                  <td><strong>AIRHSP:</strong></td>
                  <td>{{data.airhsp}}</td>
                </tr>
              </table>
            </mat-card-content>
          </mat-card>
        </section>

        <!-- Columna derecha: Ingresos / Egresos -->
        <aside class="right-col">
          <h2 class="section-title">Ingresos</h2>
          <mat-card class="boleta-card doc-card small-card">
            <mat-card-content>
              <table mat-table [dataSource]="ingresos" class="doc-mat-table">
                <ng-container matColumnDef="concepto">
                  <th mat-header-cell *matHeaderCellDef> Concepto </th>
                  <td mat-cell *matCellDef="let i"> {{i.concepto}} </td>
                </ng-container>
                <ng-container matColumnDef="monto">
                  <th mat-header-cell *matHeaderCellDef> Monto (S/.) </th>
                  <td mat-cell *matCellDef="let i"> {{i.monto | number:'1.2-2'}} </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="ingresosDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: ingresosDisplayedColumns;"></tr>
              </table>
              <div class="doc-total"><strong>Total Ingresos:</strong> {{totalIngresos | currency:'S/.'}}</div>
            </mat-card-content>
          </mat-card>

          <h2 class="section-title" style="margin-top:14px;">Egresos</h2>
          <mat-card class="boleta-card doc-card small-card">
            <mat-card-content>
              <table mat-table [dataSource]="egresos" class="doc-mat-table">
                <ng-container matColumnDef="concepto">
                  <th mat-header-cell *matHeaderCellDef> Concepto </th>
                  <td mat-cell *matCellDef="let e"> {{e.concepto}} </td>
                </ng-container>
                <ng-container matColumnDef="monto">
                  <th mat-header-cell *matHeaderCellDef> Monto (S/.) </th>
                  <td mat-cell *matCellDef="let e"> {{e.monto | number:'1.2-2'}} </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="egresosDisplayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: egresosDisplayedColumns;"></tr>
              </table>
              <div class="doc-total"><strong>Total Egresos:</strong> {{totalEgresos | currency:'S/.'}}</div>
              <div class="doc-total neto">Saldo Neto: {{(totalIngresos - totalEgresos) | currency:'S/.'}}</div>
            </mat-card-content>
          </mat-card>
        </aside>

        <!-- Pie del documento -->
        <footer class="doc-footer">
          <div>Generado: {{ today | date:'medium' }}</div>
          <div>Emitido por: Sistema de Boletas</div>
        </footer>
      </main>
    </div>
  </div>
</div>

<!-- Loading / vacío -->
<div *ngIf="isLoading" class="doc-loading no-print">
  <mat-spinner></mat-spinner>
  <div>Cargando...</div>
</div>
<div *ngIf="!isLoading && !data" class="doc-empty no-print">
  No se encontró información para el ID proporcionado.
</div>